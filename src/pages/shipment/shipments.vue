<template>
<div>
		
	<div class="top-line product-page">
		<CompanyBarTop :data="companyBarTopData" v-model="activeCompanyUid"></CompanyBarTop>
		<Notification></Notification>
		<PersonalBar></PersonalBar>
	</div>
	<top-nav></top-nav>

	<div class="orders-heading">
			<div class="orders-heading-elem">
			<div class="orders-heading-item">
				<div class="orders-heading-text">Контрагент:</div>
				<SelectInput 
					:data="companyBarTopData"
					v-model="activeCompanyUid"
				/>
			</div>
			<div class="orders-heading-item">
				<div class="orders-heading-text">Договор:</div>
				<SelectInput 
					:data="dogovor"
				/>
			</div>
			<div class="orders-heading-item" data-select2-id="147">
				<div class="orders-heading-text">Период:</div>
					<SelectInput 
						:data="period"
					/>

			</div>
			<div class="orders-heading-clean"></div>
			</div>
			<div class="orders-heading-elem">
			<router-link 
				tag="a" 
				:to="'/shipments/request'"
				class="content-heading-btn"
			>
				<svg class="content-heading-btn-img" width="40" height="24" viewBox="0 0 40 24" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path class="fill" d="M10.8337 20.6667H7.50033C7.04033 20.6667 6.66699 20.2933 6.66699 19.8333C6.66699 19.3733 7.04033 19 7.50033 19H10.8337C11.2937 19 11.667 19.3733 11.667 19.8333C11.667 20.2933 11.2937 20.6667 10.8337 20.6667Z" fill="#A5A7A9"></path>
				<path class="fill" d="M37.9176 20.6665H35.8342C35.3742 20.6665 35.0009 20.2932 35.0009 19.8332C35.0009 19.3732 35.3742 18.9998 35.8342 18.9998H37.2259L38.3492 13.0132C38.3342 9.94984 35.7176 7.33317 32.5009 7.33317H27.0292L24.3776 18.9998H29.1676C29.6276 18.9998 30.0009 19.3732 30.0009 19.8332C30.0009 20.2932 29.6276 20.6665 29.1676 20.6665H23.3342C23.0809 20.6665 22.8409 20.5515 22.6826 20.3532C22.5242 20.1565 22.4642 19.8965 22.5209 19.6498L25.5509 6.3165C25.6376 5.93484 25.9742 5.6665 26.3642 5.6665H32.5009C36.6359 5.6665 40.0009 9.0315 40.0009 13.1665L38.7359 19.9865C38.6626 20.3815 38.3192 20.6665 37.9176 20.6665Z" fill="#A5A7A9"></path>
				<path class="fill" d="M32.4997 23.9998C30.203 23.9998 28.333 22.1315 28.333 19.8332C28.333 17.5348 30.203 15.6665 32.4997 15.6665C34.7963 15.6665 36.6663 17.5348 36.6663 19.8332C36.6663 22.1315 34.7963 23.9998 32.4997 23.9998ZM32.4997 17.3332C31.1213 17.3332 29.9997 18.4548 29.9997 19.8332C29.9997 21.2115 31.1213 22.3332 32.4997 22.3332C33.878 22.3332 34.9997 21.2115 34.9997 19.8332C34.9997 18.4548 33.878 17.3332 32.4997 17.3332Z" fill="#A5A7A9"></path>
				<path class="fill" d="M14.1667 23.9998C11.87 23.9998 10 22.1315 10 19.8332C10 17.5348 11.87 15.6665 14.1667 15.6665C16.4633 15.6665 18.3333 17.5348 18.3333 19.8332C18.3333 22.1315 16.4633 23.9998 14.1667 23.9998ZM14.1667 17.3332C12.7883 17.3332 11.6667 18.4548 11.6667 19.8332C11.6667 21.2115 12.7883 22.3332 14.1667 22.3332C15.545 22.3332 16.6667 21.2115 16.6667 19.8332C16.6667 18.4548 15.545 17.3332 14.1667 17.3332Z" fill="#A5A7A9"></path>
				<path class="fill" d="M10.833 5.66667H4.16634C3.70634 5.66667 3.33301 5.29334 3.33301 4.83334C3.33301 4.37333 3.70634 4 4.16634 4H10.833C11.293 4 11.6663 4.37333 11.6663 4.83334C11.6663 5.29334 11.293 5.66667 10.833 5.66667Z" fill="#A5A7A9"></path>
				<path class="fill" d="M10.8337 10.6667H2.50033C2.04033 10.6667 1.66699 10.2933 1.66699 9.83333C1.66699 9.37333 2.04033 9 2.50033 9H10.8337C11.2937 9 11.667 9.37333 11.667 9.83333C11.667 10.2933 11.2937 10.6667 10.8337 10.6667Z" fill="#A5A7A9"></path>
				<path class="fill" d="M10.8333 15.6667H0.833333C0.373333 15.6667 0 15.2933 0 14.8333C0 14.3733 0.373333 14 0.833333 14H10.8333C11.2933 14 11.6667 14.3733 11.6667 14.8333C11.6667 15.2933 11.2933 15.6667 10.8333 15.6667Z" fill="#A5A7A9"></path>
				<path class="fill" d="M23.3337 20.6665H17.5003C17.0403 20.6665 16.667 20.2932 16.667 19.8332C16.667 19.3732 17.0403 18.9998 17.5003 18.9998H22.6687L26.4553 2.33317H7.50033C7.04033 2.33317 6.66699 1.95984 6.66699 1.49984C6.66699 1.03984 7.04033 0.666504 7.50033 0.666504H27.5003C27.7537 0.666504 27.9937 0.781504 28.152 0.979838C28.3103 1.1765 28.3703 1.4365 28.3137 1.68317L24.147 20.0165C24.0603 20.3982 23.722 20.6665 23.3337 20.6665Z" fill="#A5A7A9"></path>
				</svg>
				<div class="content-heading-btn-text">Создать заявку</div>
			</router-link>
		</div>
	</div>
	<OrdersSearchCard
		:data="{left:header, right:dogovor}"
		v-model="search"
	/>
	<ShipmentsListCard
		:data="shipmentsList"
	/>
		
 </div>
</template>



<script lang="ts">
import PersonalBar from '@/components/cards/PersonalBar.vue'
import Notification from '@/components/cards/Notification.vue'
import CompanyBarTop from '@/components/cards/Company/CompanyBarTop.vue'
import TopNav from '@/components/nav/TopNav.vue'
import SelectInput from '@/components/ui/SelectInput.vue'
import OrdersSearchCard from '@/components/cards/Order/OrdersSearchCard.vue'
import ShipmentsListCard from '@/components/cards/Shipment/ShipmentsListCard.vue'

import { useStore } from 'vuex'
import { ref, computed, onMounted, defineComponent } from 'vue'
import { key } from '@/store'
import { CompanyActions } from '@/store/company/actions'
import { ShipmentsMutations } from '@/store/shipments/mutations'

export default defineComponent({
	components:{
		PersonalBar,
		Notification,
		CompanyBarTop,
		TopNav,
		SelectInput,
		OrdersSearchCard,
		ShipmentsListCard
	},
	setup(){
		const store = useStore(key);
		const activeCompanyUid = ref('');
		const search = ref({left: 1, right: 0});
		const dogovor = ref([
			{id: 1, name:'По умолчанию № 1'},
			{id: 2, name:'По умолчанию № 2'},
			{id: 3, name:'По умолчанию № 3'},
			{id: 4, name:'По умолчанию № 4'},
		]);
		const header = [
			{id: 1, name: 'Наименование'},
			{id: 2, name: 'Контрагент'},
			{id: 3, name: 'Желаемая дата'},
			{id: 4, name: 'Номер'},
			{id: 5, name: 'Дата отгрузки'},
			{id: 6, name: 'Статус'},
		];
		const period = computed(() => {
			let res = [];
			let d = new Date();

			for (var i = 0; i < 15; i++){
				let s = new Date(d.getFullYear(), d.getMonth()-i, 1).toLocaleString().substr(0,10) +' - ';
				s = s + (new Date(d.getFullYear(), d.getMonth()-i+1, 0)).toLocaleString().substr(0,10);
				res.push({id: i+1, name: s})
			}
			return res;
		});

	
			onMounted(() => {
			store.commit(ShipmentsMutations.SET_SHIPMENT);
			if (!store.getters.isCompanysLoad)
			{
				store.dispatch(CompanyActions.GET_COMPANYS)
					.then(() =>{
						activeCompanyUid.value = store.getters.getCompanys === [] ? '' : store.getters.getCompanys[0].uid;
					})
			}
			
		});

		return{
			companyBarTopData: computed(() => store.getters.getCompanysList),
			shipmentsList: computed(() => store.getters.getShipments),
			activeCompanyUid,
			dogovor,
			period,
			header,
			search,
		}
	}
})
</script>